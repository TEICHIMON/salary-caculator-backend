<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.salary.calculator.mapper.SalaryTypeMapper">
    
    <select id="findByUserId" resultType="com.salary.calculator.entity.SalaryType">
        SELECT * FROM salary_types 
        WHERE (user_id = #{userId} OR user_id IS NULL) AND is_active = true
        ORDER BY created_at DESC
    </select>
    
    <select id="findAllActive" resultType="com.salary.calculator.entity.SalaryType">
        SELECT * FROM salary_types 
        WHERE is_active = true AND user_id IS NULL
        ORDER BY created_at DESC
    </select>
    
    <select id="findById" resultType="com.salary.calculator.entity.SalaryType">
        SELECT * FROM salary_types WHERE id = #{id}
    </select>
    
    <insert id="insert" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO salary_types (name, hourly_rate, user_id, is_active, created_at, created_by, updated_at, updated_by)
        VALUES (#{name}, #{hourlyRate}, #{userId}, #{isActive}, CURRENT_TIMESTAMP, #{createdBy}, CURRENT_TIMESTAMP, #{updatedBy})
    </insert>
    
    <update id="update">
        UPDATE salary_types 
        SET name = #{name}, 
            hourly_rate = #{hourlyRate}, 
            is_active = #{isActive},
            updated_at = CURRENT_TIMESTAMP,
            updated_by = #{updatedBy}
        WHERE id = #{id}
    </update>
    
    <delete id="delete">
        DELETE FROM salary_types WHERE id = #{id}
    </delete>
    
</mapper>
